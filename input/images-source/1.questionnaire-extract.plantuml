@startuml

actor Salesforce
participant "Form Tool" as UI
participant "API Gateway" as GW
participant "FHIR Server" as FHIR
participant "Internal Extract Process" as Extract

Salesforce -> UI : Magic Link (Questionnaire)
UI -> GW : QuestionnaireResponse
GW -> FHIR : QuestionnaireResponse

' Immediate confirmation back to Salesforce
FHIR --> GW : confirmation
GW --> UI : confirmation
UI --> Salesforce : confirmation

FHIR -> FHIR : Validate Data

' Asynchronous extract process
FHIR -> Extract : Trigger Extract Process
Extract -> Extract : Process Data
Extract --> FHIR : Create Resource(s)

@enduml
